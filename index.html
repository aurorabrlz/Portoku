// Import necessary libraries
import React, { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Select, SelectTrigger, SelectValue, SelectContent, SelectItem } from "@/components/ui/select";
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';

const PortfolioTracker = () => {
  const [currency, setCurrency] = useState("IDR");
  const [equity, setEquity] = useState(0);
  const [expenses, setExpenses] = useState([]);
  const [history, setHistory] = useState([]);
  const [chartData, setChartData] = useState([]);

  const allocation = {
    BBCA: 0.25,
    GOOGL: 0.25,
    BTC: 0.3,
    CASH: 0.2,
  };

  const convertCurrency = (amount) => {
    const rate = 0.000065; // example rate IDR to USD
    return currency === "IDR" ? amount : amount * rate;
  };

  const handleTopUp = (amount) => {
    const numericAmount = parseFloat(amount);
    if (!isNaN(numericAmount)) {
      const newEquity = equity + numericAmount;
      setEquity(newEquity);
      setHistory([...history, { type: "Top Up", amount: numericAmount, date: new Date().toLocaleString() }]);
      setChartData([...chartData, { date: new Date().toLocaleDateString(), equity: newEquity }]);
    }
  };

  const handleWithdraw = (amount) => {
    const numericAmount = parseFloat(amount);
    if (!isNaN(numericAmount) && numericAmount <= equity) {
      const newEquity = equity - numericAmount;
      setEquity(newEquity);
      setHistory([...history, { type: "Withdraw", amount: numericAmount, date: new Date().toLocaleString() }]);
      setChartData([...chartData, { date: new Date().toLocaleDateString(), equity: newEquity }]);
    }
  };

  const handleExpense = (description, amount) => {
    const numericAmount = parseFloat(amount);
    if (!isNaN(numericAmount)) {
      setExpenses([...expenses, { description, amount: numericAmount, date: new Date().toLocaleString() }]);
      setHistory([...history, { type: "Expense", description, amount: numericAmount, date: new Date().toLocaleString() }]);
    }
  };

  return (
    <div className="p-4 space-y-6">
      <div className="flex items-center space-x-4">
        <Select onValueChange={setCurrency} defaultValue="IDR">
          <SelectTrigger className="w-[100px]">
            <SelectValue placeholder="Currency" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="IDR">IDR</SelectItem>
            <SelectItem value="USD">USD</SelectItem>
          </SelectContent>
        </Select>
        <span className="text-xl font-semibold">Total Equity: {currency === "IDR" ? "Rp" : "$"}{convertCurrency(equity).toLocaleString()}</span>
      </div>

      <div className="flex space-x-4">
        <Input type="number" placeholder="Top Up Amount" id="topup" />
        <Button onClick={() => handleTopUp(document.getElementById("topup").value)}>Add</Button>
      </div>

      <div className="flex space-x-4">
        <Input type="number" placeholder="Withdraw Amount" id="withdraw" />
        <Button onClick={() => handleWithdraw(document.getElementById("withdraw").value)}>Withdraw</Button>
      </div>

      <div className="flex space-x-4">
        <Input type="text" placeholder="Expense Description" id="expenseDesc" />
        <Input type="number" placeholder="Amount" id="expenseAmt" />
        <Button onClick={() => handleExpense(document.getElementById("expenseDesc").value, document.getElementById("expenseAmt").value)}>Add Expense</Button>
      </div>

      <Card>
        <CardContent>
          <h2 className="text-lg font-semibold mb-2">Portfolio Allocation</h2>
          <ul className="list-disc pl-4">
            {Object.entries(allocation).map(([asset, percent]) => (
              <li key={asset}>{asset}: {currency === "IDR" ? "Rp" : "$"}{convertCurrency(equity * percent).toLocaleString()}</li>
            ))}
          </ul>
        </CardContent>
      </Card>

      <Card>
        <CardContent>
          <h2 className="text-lg font-semibold mb-2">Transaction History</h2>
          <ul className="pl-4 space-y-1">
            {history.map((tx, idx) => (
              <li key={idx}>
                [{tx.date}] {tx.type}: {tx.description ? tx.description + " - " : ""}{currency === "IDR" ? "Rp" : "$"}{convertCurrency(tx.amount).toLocaleString()}
              </li>
            ))}
          </ul>
        </CardContent>
      </Card>

      <Card>
        <CardContent>
          <h2 className="text-lg font-semibold mb-2">Equity Over Time</h2>
          <ResponsiveContainer width="100%" height={300}>
            <LineChart data={chartData}>
              <CartesianGrid strokeDasharray="3 3" />
              <XAxis dataKey="date" />
              <YAxis />
              <Tooltip />
              <Line type="monotone" dataKey="equity" stroke="#8884d8" strokeWidth={2} />
            </LineChart>
          </ResponsiveContainer>
        </CardContent>
      </Card>
    </div>
  );
};

export default PortfolioTracker;
